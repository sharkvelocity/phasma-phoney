<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phasma-Phoney</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
    }
    h1 {
      margin-top: 40px;
      font-size: 2.5em;
      color: cyan;
      text-shadow: 0 0 10px cyan;
    }
    button {
      background: #222;
      color: white;
      border: 1px solid #666;
      padding: 10px;
      margin: 5px;
      cursor: pointer;
    }
    #start-btn {
      font-size: 16px;
      margin-top: 20px;
    }
    .hidden {
      display: none;
    }
    #game-screen {
      display: flex;
      width: 100vw;
      height: 100vh;
      justify-content: space-between;
      padding: 10px;
    }
    #left-panel, #right-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
    }
    #center-panel {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    #narrator-box, #main-readout, #hud-status {
      background: #111;
      padding: 10px;
      margin: 5px;
      border: 1px solid #444;
      width: 90%;
    }
    #mini-map {
      border: 2px solid green;
      padding: 4px;
      height: 100px;
      width: 100px;
      text-align: center;
      font-size: 12px;
    }
    .orb {
      position: absolute;
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      opacity: 0;
      animation-name: drift, fade;
      animation-timing-function: linear, ease-in-out;
      animation-iteration-count: infinite;
      pointer-events: none;
    }
    @keyframes drift {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(var(--dx), var(--dy));
      }
    }
    @keyframes fade {
      0%, 100% { opacity: 0; }
      50% { opacity: 0.8; }
    }
  </style>
</head>
<body>
  <h1>Phasma-Phoney</h1>
  <button id="start-btn">Start Investigation</button>

  <div id="game-screen" class="hidden">
    <div id="left-panel">
      <div id="option-buttons"></div>
      <button id="journal-btn">Journal</button>
      <button id="guess-btn">Guess Ghost</button>
      <button id="item-btn">Use Item</button>
      <button id="van-btn">Return to Van</button>
    </div>
    <div id="center-panel">
      <div id="narrator-box">Welcome!</div>
      <div id="hud-status">Sanity: 100% XP: 0 Inventory: none</div>
      <div id="main-readout">Awaiting interaction...</div>
    </div>
    <div id="right-panel">
      <div id="mini-map">Room: Unknown</div>
      <div id="movement-buttons">
        <button onclick="move('North')">Up</button>
        <div>
          <button onclick="move('West')">Left</button>
          <button onclick="move('East')">Right</button>
        </div>
        <button onclick="move('South')">Down</button>
      </div>
    </div>
  </div>
  <div id="journal-screen" class="screen hidden" style="position:absolute;top:10%;left:10%;width:80%;background:#111;padding:12px;border:2px solid #666;z-index:999;">
    <h2>Investigation Journal</h2>
    <textarea id="journal-entry" placeholder="Write your notes here..." style="width:100%;height:120px;"></textarea>
    <br/>
    <button id="save-journal">Save</button>
    <button id="close-journal">Close</button>
  </div>
  <!-- =====================
 1. Utility + DOM Setup
======================= -->
<script>
function appendReadout(text) {
  const log = document.getElementById('main-readout');
  log.innerText += `\n${text}`;
  log.scrollTop = log.scrollHeight;
}

function displayNarratorText(text) {
  document.getElementById('narrator-box').innerText = text;
  appendReadout(text);
}

window.displayNarratorText = displayNarratorText;
window.addToReadout = appendReadout;

for (let i = 0; i < 10; i++) {
  const orb = document.createElement('div');
  orb.className = 'orb';
  orb.style.left = Math.random() * 100 + 'vw';
  orb.style.top = Math.random() * 100 + 'vh';
  const dx = (Math.random() - 0.5) * 200 + 'px';
  const dy = (Math.random() - 0.5) * 200 + 'px';
  orb.style.setProperty('--dx', dx);
  orb.style.setProperty('--dy', dy);
  const duration = 8 + Math.random() * 5;
  orb.style.animationDuration = `${duration}s, ${duration}s`;
  orb.style.animationDelay = `${Math.random() * 5}s, ${Math.random() * 5}s`;
  document.body.appendChild(orb);
}
</script>

<!-- =====================
 2. Mechanics.js (Sanity, XP)
======================= -->
<script>
let sanity = 100;
let xp = 0;

function getSanity() { return sanity; }
function adjustSanity(amount) {
  sanity = Math.max(0, Math.min(100, sanity + amount));
}
function getXP() { return xp; }
function addXP(amount) { xp += amount; }
</script>

<!-- =====================
 3. Inventory.js
======================= -->
<script>
let inventory = [];

function addItemToInventory(item) {
  if (inventory.length >= 3) return `‚ùå Max 3 items.`;
  inventory.push(item);
  return `‚úÖ Added ${item}`;
}

function getInventory() {
  return [...inventory];
}

function useItem(item, room, ghostType) {
  const i = inventory.indexOf(item);
  if (i === -1) return `‚ùå No ${item}`;
  inventory.splice(i, 1);
  return `üîß You used ${item} in ${room}.`;
}
</script>

<!-- =====================
 4. Map.js
======================= -->
<script>
let currentRoom = 'Foyer';

const roomMap = {
  'Foyer': { North: 'Living Room', East: 'Garage', South: null, West: null },
  'Living Room': { South: 'Foyer' },
  'Garage': { West: 'Foyer' }
};

function movePlayer(direction) {
  const next = roomMap[currentRoom]?.[direction];
  if (next) {
    currentRoom = next;
    return `üö™ Moved ${direction} to ${next}`;
  }
  return `‚ùå Can't move ${direction}`;
}

function getCurrentRoom() {
  return currentRoom;
}
</script>

<!-- =====================
 5. Ghosts.js
======================= -->
<script>
const ghostList = ['Spirit', 'Poltergeist', 'Demon', 'Succubus'];
let currentGhost = null;

function getRandomGhost() {
  const type = ghostList[Math.floor(Math.random() * ghostList.length)];
  return { type, behavior: generateBehavior(type) };
}

function generateBehavior(type) {
  const base = [
    (r) => `You feel watched in the ${r}.`,
    (r) => `A soft sound echoes in the ${r}.`
  ];
  const special = {
    'Succubus': [(r) => `Whispers tease in the ${r}.`],
    'Demon': [(r) => `Growls shake the ${r}.`]
  };
  const pool = [...base, ...(special[type] || [])];
  return (r) => pool[Math.floor(Math.random() * pool.length)](r);
}

function initializeGhost(g) {
  currentGhost = g;
}

function performBehavior(r) {
  return currentGhost?.behavior(r) || "...nothing happens...";
}
</script>

<!-- =====================
 6. Cursed Items + Tarot
======================= -->
<script>
function useCursedItem(name) {
  adjustSanity(-20);
  return `üîÆ You use the ${name}. Something stirs...`;
}
</script>

<!-- =====================
 7. Journal.js
======================= -->
<script>
let journalNotes = '';
function initializeJournal() {
  document.getElementById('journal-entry').value = journalNotes;
}
function updateNotes(t) {
  journalNotes = t;
  displayNarratorText("üìù Notes saved.");
}
</script>

<!-- =====================
 8. Game Logic
======================= -->
<script>
function startGame() {
  const g = getRandomGhost();
  initializeGhost(g);
  displayNarratorText(`Investigation begins. Suspected: ${g.type}`);
  addItemToInventory('Flashlight');
  addItemToInventory('EMF Reader');
  addItemToInventory('Smudge Stick');
  updateHUD();
  renderOptions();
}

function updateHUD() {
  document.getElementById('hud-status').innerText = `Sanity: ${getSanity()}%  XP: ${getXP()}  Inventory: ${getInventory().join(', ') || 'none'}`;
  document.getElementById('mini-map').innerText = `Room: ${getCurrentRoom()}`;
}

function renderOptions() {
  const o = document.getElementById('option-buttons');
  o.innerHTML = '';
  [['Investigate', investigate], ['Use Item', useItemMenu], ['Move', moveMenu], ['Guess Ghost', guessGhostUI], ['Return to Van', endGame]].forEach(([label, fn]) => {
    const b = document.createElement('button');
    b.innerText = label;
    b.onclick = fn;
    o.appendChild(b);
  });
}

function investigate() {
  displayNarratorText(performBehavior(getCurrentRoom()));
  adjustSanity(-5);
  updateHUD();
}

function useItemMenu() {
  const o = document.getElementById('option-buttons');
  o.innerHTML = '';
  const items = getInventory();
  if (!items.length) return displayNarratorText("üß≥ No items.");
  items.forEach((i) => {
    const b = document.createElement('button');
    b.innerText = `Use ${i}`;
    b.onclick = () => {
      displayNarratorText(useItem(i, getCurrentRoom(), currentGhost.type));
      updateHUD();
      renderOptions();
    };
    o.appendChild(b);
  });
}

function moveMenu() {
  const o = document.getElementById('option-buttons');
  o.innerHTML = '';
  ['North', 'East', 'South', 'West'].forEach(dir => {
    const b = document.createElement('button');
    b.innerText = `Go ${dir}`;
    b.onclick = () => {
      displayNarratorText(movePlayer(dir));
      updateHUD();
      renderOptions();
    };
    o.appendChild(b);
  });
}

function guessGhostUI() {
  const o = document.getElementById('option-buttons');
  o.innerHTML = '';
  ghostList.forEach(g => {
    const b = document.createElement('button');
    b.innerText = g;
    b.onclick = () => {
      displayNarratorText(g === currentGhost.type ? `‚úÖ Correct! It was a ${g}.` : `üíÄ Wrong! It was ${currentGhost.type}.`);
      renderOptions();
    };
    o.appendChild(b);
  });
}

function endGame() {
  displayNarratorText("üöê You return to the van. Investigation over.");
  document.getElementById('option-buttons').innerHTML = '';
}
</script>

<!-- =====================
 9. DOMContentLoaded Wiring
======================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('start-btn').onclick = () => {
    document.getElementById('start-btn').style.display = 'none';
    document.getElementById('game-screen').classList.remove('hidden');
    startGame();
    initializeJournal();
  };

  document.getElementById('journal-btn').onclick = () => {
    document.getElementById('journal-screen').classList.toggle('hidden');
  };
  document.getElementById('close-journal').onclick = () => {
    document.getElementById('journal-screen').classList.add('hidden');
  };
  document.getElementById('save-journal').onclick = () => {
    updateNotes(document.getElementById('journal-entry').value);
  };
});
</script>
</body>
</html>
