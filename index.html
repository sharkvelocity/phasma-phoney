<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PhasmaPhoney</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #0ff;
      font-family: monospace;
      height: 100%;
      overflow: hidden;
    }

    button {
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 8px 14px;
      margin: 4px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0ff;
      color: #000;
    }

    #orb-canvas, #background-logo, #background-image {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -2;
    }

    #background-logo {
      background: url('./logo.png') center/contain no-repeat;
      opacity: 0.1;
      z-index: -3;
    }

    #background-image {
      background: url('./house.png') center/cover no-repeat;
      z-index: -2;
    }

    #status-bar {
      padding: 10px;
      background: #000;
    }

    #game-ui {
      margin: 20px;
      padding: 10px;
      border: 1px solid #0ff;
      background: #000;
    }

    #ada-modal {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      border: 2px solid #0ff;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      height: 80%;
      z-index: 1000;
      overflow-y: auto;
    }

    #loadout-screen, #journal-screen, #item-popup, #van-panel, #guess-popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      border: 2px solid #0ff;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      z-index: 9999;
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
    }

    #journal-text {
      width: 100%;
      height: 200px;
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 10px;
    }

    #evidence-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 240px;
      background: #111;
      border: 1px solid #0ff;
      padding: 10px;
      font-family: monospace;
      z-index: 9999;
    }

    footer {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 0.8em;
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 12px;
      z-index: 9999;
    }
  </style>
<head>
  <meta charset="utf-8" />
  <title>PhasmaPhoney</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body { margin: 0; padding: 0; background: #000; color: #0ff; font-family: monospace; height: 100%; overflow: hidden; }
    button { background: #000; color: #0ff; border: 1px solid #0ff; padding: 8px 14px; margin: 4px; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0ff; color: #000; }
    #orb-canvas, #background-logo, #background-image { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -2; }
    #background-logo { background: url('./logo.png') center/contain no-repeat; opacity: .1; z-index: -3; }
    #background-image { background: url('./house.png') center/cover no-repeat; z-index: -2; }
    #status-bar, #game-ui, #ada-modal, #loadout-screen, #journal-screen, #item-popup, #van-panel, #guess-popup { border: 1px solid #0ff; background: #000; }
    #status-bar { padding: 10px; background: #000; position: fixed; top: 0; width: 100%; z-index: 1000; }
    #game-ui { margin: 60px 20px 20px; padding: 10px; }
    #ada-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; width: 90%; max-width: 600px; height: 80%; padding: 20px; z-index: 1100; overflow-y: auto; }
    #loadout-screen, #journal-screen, #item-popup, #van-panel, #guess-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; width: 90%; max-width: 500px; padding: 20px; z-index: 1200; }
    #journal-text { width: 100%; height: 200px; background: #000; color: #0ff; border: 1px solid #0ff; padding: 10px; }
    #evidence-panel { position: fixed; top: 60px; right: 10px; width: 240px; background: #111; border: 1px solid #0ff; padding: 10px; z-index: 1000; }
    #guess-popup { width: auto; }
    #map-display { margin: 10px 0; font-size: .9em; }
    footer { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); color: #fff; font-size: .8em; background: rgba(0,0,0,.6); padding: 4px 12px; z-index: 1000; }
  </style>
</head>
<body>
  <canvas id="orb-canvas"></canvas>
  <div id="background-logo"></div>
  <div id="background-image"></div>

  <!-- Loadout Screen -->
  <div id="loadout-screen"><h2>Select Loadout (Max 3)</h2>
    <div id="item-selection" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
    <button onclick="confirmLoadout()">Confirm Loadout</button>
    <button onclick="randomLoadout()">Random Loadout</button>
  </div>

  <!-- Journal Screen -->
  <div id="journal-screen"><h3>Notes</h3>
    <textarea id="journal-text" placeholder="Your notes..."></textarea><br>
    <button onclick="closeJournal()">Close</button>
  </div>

  <!-- Item Popup -->
  <div id="item-popup"><h3>Choose Item</h3>
    <div id="item-button-list"></div>
    <button onclick="closeItemPopup()">Cancel</button>
  </div>

  <!-- Van Panel -->
  <div id="van-panel"><h3>Van Inventory</h3>
    <div id="van-button-list" style="display:flex; flex-direction:column; gap:6px;"></div>
    <button onclick="closeVanPanel()">Done</button>
  </div>

  <!-- Ghost Guess Popup -->
  <div id="guess-popup"><h3>Who is the Ghost?</h3>
    <div id="guess-list" style="display:flex; flex-wrap:wrap; gap:6px;"></div>
    <button onclick="closeGuess()">Cancel</button>
  </div>

  <!-- Ada Modal -->
  <div id="ada-modal"><div id="ada-log" style="height:85%; overflow-y:auto; background:#000; padding:10px;"></div>
    <div style="display:flex; flex-wrap:wrap; gap:6px; justify-content:center;">
      <button onclick="handleCommand('start')">Start</button>
      <button onclick="handleCommand('move')">Move</button>
      <button onclick="handleCommand('map')">Map</button>
      <button onclick="handleCommand('inventory')">Inventory</button>
      <button onclick="openGuess()">Guess</button>
      <button onclick="handleCommand('van')">Visit Van</button>
      <button onclick="handleCommand('end')">End</button>
      <button onclick="openItemPopup()">Use Items</button>
    </div>
  </div>

  <!-- Status Bar & Map -->
  <div id="status-bar">Turn: <span id="turn-counter">0</span> |
    Sanity: <span id="sanity-bar">100</span>% | <span id="map-display"></span>
  </div>

  <!-- Evidence Panel -->
  <div id="evidence-panel"><h3 style="margin:0;">Evidence</h3>
    <div id="evidence-checklist"></div>
    <p id="remaining-ghosts" style="color:#0f0;"></p>
  </div>

  <!-- Main UI -->
  <div id="game-ui"></div>
  <footer>Phasma‑Phoney v1.4 — Full Gameplay</footer>

<script>
const allLoadoutItems = ["EMF","Spirit Box","UV","Camera","D.O.T.S","Book","Thermometer","Smudge","Crucifix","Salt","Candle"];
const evidenceTypes = ["EMF Level 5","Spirit Box","Fingerprints","Ghost Writing","Freezing Temps","D.O.T.S","Orbs"];
const evidenceMap = {
  spirit: ["EMF Level 5","Spirit Box","Ghost Writing"],
  wraith: ["EMF Level 5","D.O.T.S","Spirit Box"],
  poltergeist: ["Spirit Box","Ghost Writing","Fingerprints"],
  demon: ["Ghost Writing","Freezing Temps","Fingerprints"],
  succubus: ["Spirit Box","Freezing Temps","Orbs"]
};
let selectedEvidence = new Set();

const ghostProfiles = {
  spirit: {intro:"Calm presence", tools:["emf","spirit box","book"], behavior:"You hear soft whispers...", roomHint:"Library"},
  wraith: {intro:"Avoids salt", tools:["emf","dots","spirit box"], behavior:"The air shifts...but salt untouched.", roomHint:"Bathroom"},
  poltergeist: {intro:"Throws items", tools:["spirit box","book","uv"], behavior:"Objects rattle violently!", roomHint:"Kitchen"},
  demon: {intro:"Aggressive early", tools:["book","thermometer","uv"], behavior:"A low growl echoes!", roomHint:"Basement"},
  succubus:{intro:"Seductive chill", tools:["spirit box","thermometer","camera"],behavior:"A chill passes your spine.", roomHint:"Bedroom"}
};

let game = {
  inventory: [], vanStock:{}, turn:0, sanity:100, ghost:null, ghostRoom:null,
  position:[0,0], roomMap:[["Van","Foyer","Kitchen"],["Basement","Living Room","Bathroom"],["Garage","Bedroom","Storage"]]
};

function showLoadoutScreen(){
  const div=document.getElementById("loadout-screen"),
        sel=document.getElementById("item-selection");
  sel.innerHTML=""; game.inventory=[]; let selected=[];
  allLoadoutItems.forEach(item=>{
    let btn=document.createElement("button"); btn.textContent=item;
    btn.onclick=()=>{
      if(selected.includes(item)){selected=selected.filter(i=>i!==item);btn.style.background="";}
      else if(selected.length<3){selected.push(item);btn.style.background="#0ff";}
      else alert("Max 3");
    };
    sel.appendChild(btn);
  });
  div.style.display="block";
}

function confirmLoadout(){
  game.inventory=["Notebook","Lighter",...Array.from(document.querySelectorAll("#item-selection button")).filter(b=>b.style.background).map(b=>b.textContent)];
  const vs = {}; allLoadoutItems.forEach(i=>vs[i]=2); game.vanStock = vs;
  document.getElementById("loadout-screen").style.display="none"; document.getElementById("ada-modal").style.display="block";
  log("Loadout confirmed.");
  loadJournal(); renderEvidence(); updateMap();
}

function randomLoadout(){
  const r = allLoadoutItems.sort(()=>.5-Math.random()).slice(0,3);
  game.inventory=["Notebook","Lighter",...r];
  document.getElementById("loadout-screen").style.display="none"; document.getElementById("ada-modal").style.display="block";
  log("Random loadout: "+r.join(", "));
  loadJournal(); renderEvidence(); updateMap();
}

function loadJournal(){
  const t=localStorage.getItem("journal"); if(t) document.getElementById("journal-text").value=t;
}

function saveJournal(){
  localStorage.setItem("journal",document.getElementById("journal-text").value);
}

function openJournal(){document.getElementById("journal-screen").style.display="block";}
function closeJournal(){saveJournal();document.getElementById("journal-screen").style.display="none";}

function openItemPopup(){
  const pop=document.getElementById("item-popup"), lst=document.getElementById("item-button-list");
  lst.innerHTML="";
  game.inventory.forEach(item=>{
    let b=document.createElement("button"); b.textContent=item;
    b.onclick=()=>{
      useItem(item); closeItemPopup();
    };
    lst.appendChild(b);
  });
  pop.style.display="block";
}
function closeItemPopup(){document.getElementById("item-popup").style.display="none";}

function useItem(item){
  log("Used: "+item);
  const ghost=ghostProfiles[game.ghost];
  let roomName=game.roomMap[game.position[0]][game.position[1]];
  switch(item.toLowerCase()){
    case "emf":
    case "emf reader":
      if(["emf"].includes(item.toLowerCase()) && ghost.tools.includes("emf") && roomName===game.ghostRoom){
        log("EMF spikes to 5!"); checkEvidence("EMF Level 5");
      } else log("No EMF reading.");
      break;
    case "spirit box":
      if(ghost.tools.includes("spirit box") && roomName===game.ghostRoom){log("Spirit Box crackles!"); checkEvidence("Spirit Box");}
      else log("Only static.");
      break;
    case "uv": case "uv light":
      if(ghost.tools.includes("uv") && roomName===game.ghostRoom){log("Fingerprints detected!"); checkEvidence("Fingerprints");}
      else log("Nothing glows.");
      break;
    case "book": case "notebook":
      if(ghost.tools.includes("book") && roomName===game.ghostRoom){log("Ghost writing appears!"); checkEvidence("Ghost Writing");}
      else log("Still blank.");
      break;
    case "thermometer":
      if(ghost.tools.includes("thermometer") && roomName===game.ghostRoom){log("Freezing temps detected!"); checkEvidence("Freezing Temps");}
      else log("Temp normal.");
      break;
    case "dots":
      if(ghost.tools.includes("dots") && roomName===game.ghostRoom){log("Motion on DOTS projector!"); checkEvidence("D.O.T.S");}
      else log("No motion.");
      break;
    case "camera":
      if(ghost.tools.includes("camera") && roomName===game.ghostRoom){log("Ghostly orbs captured!"); checkEvidence("Orbs");}
      else log("No orbs.");
      break;
    case "salt":
      log(ghost.intro); break;
    case "smudge":
      if(game.vanStock["Smudge"]) game.vanStock["Smudge"]--, log("Smudge protects you.");
      break;
    case "crucifix":
      log("Crucifix placed.");
      break;
    default:
      break;
  }
}

function checkEvidence(ev){
  selectedEvidence.add(ev); document.querySelectorAll("#evidence-checklist input").forEach(c=>{if(c.nextSibling.textContent==ev)c.checked=true;});
  renderEvidence();
}
function renderEvidence(){
  const container=document.getElementById("evidence-checklist");
  container.innerHTML=""; evidenceTypes.forEach(ev=>{
    let l=document.createElement("label"), c=document.createElement("input"); c.type="checkbox"; c.checked=selectedEvidence.has(ev);
    c.onchange=()=>{
      if(c.checked)selectedEvidence.add(ev);else selectedEvidence.delete(ev);
      renderEvidence();
    };
    l.appendChild(c); l.appendChild(document.createTextNode(ev));
    container.appendChild(l);
  });
  const poss=Object.keys(evidenceMap).filter(g=>[...selectedEvidence].every(e=>evidenceMap[g].includes(e)));
  document.getElementById("remaining-ghosts").textContent = poss.length ? "Possible: "+poss.join(", ").toUpperCase() : "No matches.";
}

function openVanPanel(){
  const pan=document.getElementById("van-panel"), lst=document.getElementById("van-button-list");
  lst.innerHTML="";
  for(const t in game.vanStock)if(game.vanStock[t]>0){
    let b=document.createElement("button");b.textContent=`Take ${t}`;b.onclick=()=>{
      if(game.inventory.length<5){game.inventory.push(t); game.vanStock[t]--;log(`Picked ${t}`); openVanPanel();}
      else log("Inventory full");
    };
    lst.appendChild(b);
  }
  lst.appendChild(document.createElement("hr"));
  game.inventory.forEach((it,i)=>{
    if(!["Notebook","Lighter"].includes(it)){
      let b=document.createElement("button");b.textContent=`Return ${it}`;b.onclick=()=>{
        game.inventory.splice(i,1); game.vanStock[it]++;log(`Returned ${it}`);openVanPanel();
      };
      lst.appendChild(b);
    }
  });
  pan.style.display="block";
}
function closeVanPanel(){document.getElementById("van-panel").style.display="none";}

function openGuess(){
  const pop=document.getElementById("guess-popup"), lst=document.getElementById("guess-list");
  lst.innerHTML="";
  Object.keys(ghostProfiles).forEach(g=>{
    let b=document.createElement("button"); b.textContent=g.toUpperCase();
    b.onclick=()=>{makeGuess(g);closeGuess();};
    lst.appendChild(b);
  });
  pop.style.display="block";
}
function makeGuess(g){
  if(g===game.ghost){log("✅ Correct! You solved it."); endGame(true);}
  else{log("❌ Incorrect. The ghost was "+game.ghost.toUpperCase()); endGame(false);}
}
function closeGuess(){document.getElementById("guess-popup").style.display="none";}

function endGame(won){
  document.getElementById("ada-modal").style.display="none";
  let msg=won? "🎉 You Win!" : "💀 You Lose!";
  alert(msg+"\nGame over.");
}

function handleCommand(cmd){
  const c=cmd.toLowerCase();
  game.turn++; document.getElementById("turn-counter").textContent=game.turn;
  if(c==="start"){
    game.ghost = Object.keys(ghostProfiles)[Math.floor(Math.random()*Object.keys(ghostProfiles).length)];
    game.ghostRoom = ghostProfiles[game.ghost].roomHint;
    log("Ghost is in the "+game.ghostRoom);
  } else if(c==="move"){
    game.position[1] = (game.position[1]+1)%3;
    updateMap(); game.sanity=Math.max(0,game.sanity-5);
    document.getElementById("sanity-bar").textContent=game.sanity;
    const here=game.roomMap[game.position[0]][game.position[1]];
    log("You move to "+here);
    if(here===game.ghostRoom) log(ghostProfiles[game.ghost].behavior);
  } else if(c==="map") updateMap();
  else if(c==="inventory") log("Inventory: "+game.inventory.join(", "));
  else if(c==="van") openVanPanel();
  else if(c==="end") endGame(game.ghost===null?false:true);
  else log("Unknown cmd.");
}

function updateMap(){
  const mapd=game.roomMap[game.position[0]][game.position[1]];
  document.getElementById("map-display").textContent="Room: "+mapd;
}

function log(txt){
  const g=document.getElementById("ada-log"),d=document.createElement("div");
  d.innerHTML="<strong>ADA:</strong> "+txt;
  g.appendChild(d); g.scrollTop=g.scrollHeight;
}

document.addEventListener("DOMContentLoaded", showLoadoutScreen);
</script>
</body>
</html>
