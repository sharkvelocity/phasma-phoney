<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PhasmaPhoney</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #000;
      font-family: monospace;
      color: #0ff;
      overflow: hidden;
    }
    #title-screen, #loadout-screen, #ada-modal, #item-use-popup, #guess-popup, #end-screen {
      display: none;
    }
    #title-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 5000;
    }
    #title-screen img {
      max-width: 80%;
      margin-bottom: 30px;
    }
    button {
      background: #111;
      color: #0ff;
      font-family: monospace;
      border: 1px solid #0ff;
      padding: 6px 12px;
      cursor: pointer;
    }
    #ada-modal {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      color: #0ff;
      width: 90%;
      max-width: 600px;
      height: 80%;
      padding: 20px;
      z-index: 9999;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #ada-log {
      height: 70%;
      overflow-y: auto;
      width: 100%;
      background: #000;
      padding: 10px;
      border: 1px solid #333;
      margin-bottom: 10px;
    }
    #item-selection label {
      color: #0ff;
      margin-right: 12px;
    }
  </style>
</head>
<body>

<div id="title-screen">
  <img src="./logo.png" alt="PhasmaPhoney Logo" />
  <button onclick="showLoadoutMenu()">Start Investigation</button>
  <p style="margin-top:10px;font-style:italic;">Deo: ‚ÄúHope your guesswork's better than your flashlight.‚Äù</p>
</div>

<div id="loadout-screen">
  <h2 style="text-align:center;">Select Your Loadout (Pick 3 Items)</h2>
  <div id="item-selection" style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:20px 0;"></div>
  <div style="text-align:center;">
    <button onclick="confirmLoadout()">Confirm</button>
  </div>
</div>

<div id="ada-modal">
  <div id="room-label">Current room: <span id="room-name">Van</span></div>
  <div id="ada-log">ADA: Investigation interface activated.</div>
  <div style="margin: 10px 0;">
    <button onclick="handleAdaCommand('map')">üó∫ Map</button>
    <button onclick="handleAdaCommand('inventory')">üì¶ Inventory</button>
    <button onclick="handleAdaCommand('end')">üö´ End</button>
  </div>
</div>

<footer style="position:fixed;bottom:0;width:100%;text-align:center;background:#000;color:#0ff;padding:10px;">
  Shark‚ÄëBlades ‚Äî Phasma‚ÄëPhoney Prototype Web Build v1.4.3
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const allLoadoutItems = ["EMF", "Spirit Box", "Thermometer", "Crucifix", "Salt", "Smudge"];
  const game = {
    started: false,
    inventory: [],
    ghost: null,
    roomNameMap: [
      ["Van", "Foyer", "Kitchen"],
      ["Basement", "Living Room", "Bathroom"],
      ["Garage", "Bedroom", "Storage"]
    ],
    position: [0, 0],
    sanity: 100
  };

  const ghostProfiles = {
    spirit: { behavior: "You hear faint whispers behind you." },
    demon: { behavior: "Growl... the air turns hostile!" },
    oni: { behavior: "A burst of movement rushes past!" }
  };

  function showLoadoutMenu() {
    const container = document.getElementById("item-selection");
    container.innerHTML = "";
    allLoadoutItems.forEach(item => {
      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = item;
      checkbox.onchange = limitLoadoutCheck;
      label.appendChild(checkbox);
      label.append(" " + item);
      container.appendChild(label);
    });
    document.getElementById("title-screen").style.display = "none";
    document.getElementById("loadout-screen").style.display = "block";
  }

  function limitLoadoutCheck() {
    const selected = document.querySelectorAll('#item-selection input:checked');
    if (selected.length > 3) this.checked = false;
  }

  function confirmLoadout() {
    const selected = Array.from(document.querySelectorAll('#item-selection input:checked'));
    if (selected.length > 3) return alert("Max 3 items.");
    game.inventory = selected.map(cb => cb.value);
    document.getElementById("loadout-screen").style.display = "none";
    startInvestigation();
  }

  function startInvestigation() {
    game.started = true;
    const keys = Object.keys(ghostProfiles);
    game.ghost = keys[Math.floor(Math.random() * keys.length)];
    document.getElementById("ada-modal").style.display = "flex";
    simulateTyping("Deo: The ghost is near. Begin your investigation.");
  }

  function simulateTyping(text, from = "ADA") {
    const log = document.getElementById("ada-log");
    const line = document.createElement("div");
    line.innerHTML = `<strong>${from}:</strong> <span>${text}</span>`;
    log.appendChild(line);
    log.scrollTop = log.scrollHeight;
  }

  function handleAdaCommand(cmd) {
    simulateTyping("> " + cmd, "You");
    setTimeout(() => {
      let response = "";
      switch (cmd.toLowerCase()) {
        case "map": response = "Map unavailable in this prototype."; break;
        case "inventory": response = "You have: " + (game.inventory.length ? game.inventory.join(", ") : "nothing"); break;
        case "end":
          game.started = false;
          document.getElementById("ada-modal").style.display = "none";
          response = "Investigation ended.";
          break;
        default:
          response = "Unknown command.";
      }
      simulateTyping(response);
    }, 500);
  }

  // Make start function available globally
  window.showLoadoutMenu = showLoadoutMenu;
  window.confirmLoadout = confirmLoadout;
  window.handleAdaCommand = handleAdaCommand;
});
</script>
</body>
</html>
