<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phasma-Phoney</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .hidden { display: none; }
    button {
      background: #222;
      color: white;
      border: 1px solid #555;
      padding: 10px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    #game-screen {
      display: flex;
      justify-content: space-around;
      width: 100%;
      padding: 20px;
    }
    #journal-screen {
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      background: #111;
      color: white;
      padding: 10px;
      border: 2px solid #666;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="title-screen">
    <h1>Phasma-Phoney</h1>
    <button id="start-btn">Start Investigation</button>
  </div>

  <div id="game-screen" class="hidden">
    <div>
      <div id="option-buttons"></div>
      <button id="journal-btn">Journal</button>
      <button id="guess-btn">Guess Ghost</button>
      <button id="item-btn">Use Item</button>
      <button id="van-btn">Return to Van</button>
    </div>
    <div>
      <div id="narrator-box">Narrator Text</div>
      <div id="mini-map">Room: Unknown</div>
    </div>
    <div>
      <button id="move-north">â¬†</button><br/>
      <button id="move-west">â¬…</button>
      <button id="move-east">âž¡</button><br/>
      <button id="move-south">â¬‡</button>
    </div>
  </div>

  <div id="journal-screen" class="screen hidden">
    <h3>Investigation Journal</h3>
    <textarea id="journal-entry" style="width:100%;height:100px;"></textarea>
    <button id="save-journal">Save</button>
    <button id="close-journal">Close</button>
  </div>

  <script type="module">
    window.addEventListener("error", e => {
      alert("ðŸ”¥ JavaScript Error: " + e.message);
      console.error("JavaScript Error", e);
    });

    try {
      import('./game.js').then(game => {
        import('./journal.js').then(journal => {
          import('./map.js').then(map => {
            const $ = id => document.getElementById(id);

            function updateRoomDisplay() {
              $('mini-map').innerText = `Room: ${map.getCurrentRoom()}`;
            }

            function show(text) {
              $('narrator-box').innerText = text;
            }

            window.addEventListener('DOMContentLoaded', () => {
              $('start-btn').onclick = () => {
                $('title-screen').classList.add('hidden');
                $('game-screen').classList.remove('hidden');
                game.startGame();
                journal.initializeJournal();
              };

              $('journal-btn').onclick = () => $('journal-screen').classList.toggle('hidden');
              $('close-journal').onclick = () => $('journal-screen').classList.add('hidden');
              $('save-journal').onclick = () => journal.updateNotes($('journal-entry').value);

              $('guess-btn').onclick = game.openGuessPopup;
              $('item-btn').onclick = game.handleItemUse;
              $('van-btn').onclick = game.endGame;

              $('move-north').onclick = () => { show(map.movePlayer('North')); updateRoomDisplay(); };
              $('move-south').onclick = () => { show(map.movePlayer('South')); updateRoomDisplay(); };
              $('move-east').onclick  = () => { show(map.movePlayer('East'));  updateRoomDisplay(); };
              $('move-west').onclick  = () => { show(map.movePlayer('West'));  updateRoomDisplay(); };
            });
          });
        });
      });
    } catch (e) {
      alert("ðŸ’¥ Fatal Error: " + e.message);
      console.error("Fatal Import Error", e);
    }
  </script>
</body>
</html>
