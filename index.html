<script type="module">
(async () => {
  try {
    console.log('🔧 Loading modules...');
    const game = await import('./game.js');
    const journal = await import('./journal.js');
    const { getCurrentRoom } = await import('./map.js');
    console.log('✅ Modules loaded.');

    function appendReadout(text) {
      const log = document.getElementById('main-readout');
      log.innerText += `\n${text}`;
      log.scrollTop = log.scrollHeight;
    }

    function displayNarratorText(input) {
      const narratorBox = document.getElementById('narrator-box');
      narratorBox.innerText = input;
      appendReadout(input);
      const map = document.getElementById('mini-map');
      if (map) map.innerText = 'Room: ' + getCurrentRoom();
    }

    window.displayNarratorText = displayNarratorText;
    window.addToReadout = appendReadout;

    window.addEventListener('DOMContentLoaded', () => {
      const startBtn = document.getElementById('start-btn');
      const title = document.getElementById('title-screen');
      const screen = document.getElementById('game-screen');
      const journalScreen = document.getElementById('journal-screen');

      if (!startBtn) {
        alert("🚨 Couldn't find start button");
        return;
      }

      startBtn.onclick = () => {
        console.log('✅ Start button clicked');
        console.log('🧠 Game module keys:', Object.keys(game));
        if (!game.startGame) {
          alert('🚫 startGame() is missing in game.js');
          return;
        }

        title.classList.add('hidden');
        screen.classList.remove('hidden');
        try {
          game.startGame();
          journal.initializeJournal();
          console.log('✅ startGame() executed');
        } catch (err) {
          alert('❌ Error in startGame(): ' + err.message);
          console.error(err);
        }
      };

      document.getElementById('journal-btn').onclick = () => {
        journalScreen.classList.toggle('hidden');
      };
      document.getElementById('close-journal').onclick = () => {
        journalScreen.classList.add('hidden');
      };
      document.getElementById('save-journal').onclick = () => {
        const note = document.getElementById('journal-entry').value;
        journal.updateNotes(note);
      };
    });
  } catch (err) {
    alert('🧨 Module load failure: ' + err.message);
    console.error(err);
  }
})();
</script>
