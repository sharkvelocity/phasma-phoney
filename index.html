<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phasma‑Phoney HUD</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('./House.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #hud {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #555;
      padding: 5px 15px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    #hud button {
      font-size: 12px;
      padding: 5px 10px;
      margin-left: auto;
    }

    button {
      background: #222;
      color: white;
      border: 1px solid #666;
      padding: 10px 14px;
      font-size: 14px;
      min-width: 120px;
      max-width: 100%;
      flex: 0 1 auto;
      box-sizing: border-box;
    }

    #interface-buttons,
    #action-panel,
    #van-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px;
      justify-content: center;
    }

    #loadout-screen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #loadout-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
      max-width: 90%;
      justify-content: center;
    }

    #log {
      width: 90%;
      max-height: 200px;
      overflow-y: auto;
      margin: 10px;
      background: #111;
      padding: 10px;
      border: 1px solid #444;
      white-space: pre-wrap;
    }

    #journal-panel {
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      background: #111;
      border: 1px solid #555;
      padding: 10px;
      z-index: 20;
      display: none;
    }

    #journal-panel textarea {
      width: 100%;
      height: 150px;
      background: #222;
      color: white;
      border: 1px solid #444;
      resize: none;
    }

    #journal-panel button {
      margin-top: 5px;
      width: 100%;
    }

    .orb {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      box-shadow: 0 0 8px 4px rgba(255, 255, 255, 0.15);
      opacity: 0;
      animation-name: drift, fadeGlow;
      animation-timing-function: ease-in-out;
      animation-iteration-count: 1;
      pointer-events: none;
    }

    #evidence-panel {
      display: flex;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #444;
      margin: 10px;
      padding: 10px;
      width: 90%;
      max-width: 400px;
    }

    @keyframes drift {
      from { transform: translate(0, 0); }
      to   { transform: translate(var(--dx), var(--dy)); }
    }

    @keyframes fadeGlow {
      0%   { opacity: 0; }
      30%  { opacity: 0.5; }
      60%  { opacity: 0.8; }
      100% { opacity: 0.2; }
    }

    @media (max-width: 480px) {
      #hud {
        flex-direction: column;
        gap: 5px;
        align-items: flex-start;
        font-size: 12px;
      }

      button {
        font-size: 13px;
        padding: 10px;
        min-width: 80px;
        flex: 1 1 45%;
      }

      #van-panel {
        max-width: 95vw;
        font-size: 14px;
      }

      #van-options {
        max-height: 240px;
        overflow-y: auto;
      }

      #evidence-panel {
        width: 95%;
      }
    }
  </style>
</head>
<body>
  <div id="hud">
    Turn: <span id="turn-count">1</span> |
    Sanity: <span id="sanity-count">100</span>% |
    Inventory: <span id="inventory-list">none</span> |
    XP: <span id="xp-count">0</span> |
    Level: <span id="level-count">1</span>
    <button id="journal-btn">📓</button>
  </div>

  <div id="floor-items-bar"></div>

  <div id="interface-buttons">
    <button id="van-btn">Van</button>
    <button id="action-btn">Action</button>
    <button id="guess-btn">Guess Ghost</button>
    <button onclick="showMoveMenu()">Move</button>
  </div>

  <div id="action-panel" class="hidden">
    <button id="drop-btn">Drop Item</button>
    <button id="pickup-btn">Pick Up Item</button>
    <button id="use-btn">Use Item</button>
    <button id="action-back-btn">Back</button>
  </div>

  <div id="van-panel" class="hidden" style="width: 100%; max-width: 480px; margin: auto; background: rgba(0, 0, 0, 0.85); border: 1px solid #555; padding: 10px; border-radius: 8px;">
    <div style="text-align:center; font-weight:bold; margin-bottom: 10px;">Van Inventory</div>
    <div id="van-options" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:center; max-height: 300px; overflow-y: auto;"></div>
    <div style="margin-top:10px; text-align:center;">
      <button id="van-back-btn" style="width: 45%;">Back</button>
    </div>
  </div>

  <div id="loadout-screen" class="hidden">
    <h2>Select Your Loadout (max 3)</h2>
    <div id="loadout-options"></div>
    <button id="loadout-confirm">OK</button>
  </div>

  <div id="journal-panel">
    <textarea id="journal-entry" placeholder="Your investigation notes..."></textarea>
    <button id="journal-close-btn">Close</button>
  </div>

  <div id="log">Welcome to Phasma‑Phoney</div>

  <div id="evidence-panel">
    <strong>Evidence Analysis</strong>
    <div id="evidence-checklist"></div>
    <strong style="margin-top:10px;">Ghosts</strong>
    <ul id="possible-ghosts"></ul>
  </div>

  <div id="item-swap-panel" style="display:none;position:absolute;top:20%;left:50%;transform:translateX(-50%);background:#111;padding:10px;border:1px solid #555;z-index:30;width:300px;border-radius:6px;color:white;">
    <div id="item-swap-header" style="margin-bottom: 10px; text-align: center;">
      What would you drop for <span id="swap-item-name" style="font-weight:bold;"></span>?
    </div>
    <div id="item-swap-options" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"></div>
    <div style="margin-top: 10px; text-align: center;">
      <button onclick="cancelItemSwap()">Nevermind</button>
      <button onclick="confirmItemSwap()">Confirm</button>
    </div>
  </div><script>
// ==== Core Variables ====
let level = 1;
let inventory = {};
let selectedLoadout = [];
let sanity = 100;
let turn = 1;
let xp = 0;
let currentRoom = "Foyer";
let ghost = null;
let journalNotes = '';
let favoriteRoom = '';

const allEvidence = ['EMF 5', 'Spirit Box', 'Fingerprints', 'Ghost Orbs', 'Ghost Writing', 'Freezing Temps', 'D.O.T.S'];
const allItems = [
  { name: 'EMF Reader', type: 'tool', permanent: true },
  { name: 'Spirit Box', type: 'tool', permanent: true },
  { name: 'Ghost Writing Book', type: 'tool', permanent: true },
  { name: 'Candle', type: 'consumable', permanent: false },
  { name: 'Smudge Stick', type: 'consumable', permanent: false },
  { name: 'Salt', type: 'consumable', permanent: false },
  { name: 'UV Light', type: 'tool', permanent: true },
  { name: 'Thermometer', type: 'tool', permanent: true },
  { name: 'Camera', type: 'tool', permanent: true },
  { name: 'Parabolic Mic', type: 'tool', permanent: true },
  { name: 'Crucifix', type: 'tool', permanent: true },
  { name: 'Proximity Sensor', type: 'tool', permanent: true }
];

const ghostEvidenceMap = {
  Spirit: ['EMF 5', 'Spirit Box', 'Ghost Writing'],
  Wraith: ['EMF 5', 'Spirit Box', 'D.O.T.S'],
  Phantom: ['Spirit Box', 'Fingerprints', 'D.O.T.S'],
  Poltergeist: ['Spirit Box', 'Fingerprints', 'Ghost Writing'],
  Banshee: ['Fingerprints', 'Ghost Orbs', 'D.O.T.S'],
  Jinn: ['EMF 5', 'Fingerprints', 'Freezing Temps'],
  Mare: ['Spirit Box', 'Ghost Orbs', 'Ghost Writing'],
  Revenant: ['Ghost Orbs', 'Ghost Writing', 'Freezing Temps'],
  Shade: ['EMF 5', 'Ghost Writing', 'Freezing Temps'],
  Demon: ['Fingerprints', 'Ghost Writing', 'Freezing Temps'],
  Yurei: ['Ghost Orbs', 'Freezing Temps', 'D.O.T.S'],
  Oni: ['EMF 5', 'Freezing Temps', 'D.O.T.S'],
  Hantu: ['Fingerprints', 'Ghost Orbs', 'Freezing Temps'],
  Goryo: ['EMF 5', 'Fingerprints', 'D.O.T.S'],
  Myling: ['EMF 5', 'Fingerprints', 'Ghost Writing'],
  Onryo: ['Spirit Box', 'Ghost Orbs', 'Freezing Temps'],
  'The Twins': ['EMF 5', 'Spirit Box', 'Freezing Temps'],
  Raiju: ['EMF 5', 'Ghost Orbs', 'D.O.T.S'],
  Obake: ['EMF 5', 'Fingerprints', 'Ghost Orbs'],
  'The Mimic': ['Spirit Box', 'Fingerprints', 'Freezing Temps'],
  Moroi: ['Spirit Box', 'Ghost Writing', 'Freezing Temps'],
  Deogen: ['Spirit Box', 'Ghost Writing', 'D.O.T.S'],
  Thaye: ['Ghost Orbs', 'Ghost Writing', 'D.O.T.S'],
  Succubus: ['Spirit Box', 'Ghost Writing', 'EMF 5']
};

const ghostList = Object.keys(ghostEvidenceMap);
const roomList = ['Foyer', 'Living Room', 'Kitchen', 'Dining Room', 'Bathroom', 'Bedroom', 'Garage', 'Basement'];

function log(msg) {
  const logBox = document.getElementById('log');
  logBox.innerText += '\n' + msg;
  logBox.scrollTop = logBox.scrollHeight;
}

function speakNarration(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.voice = speechSynthesis.getVoices().find(v => v.lang.includes('en') && v.name.includes('Female')) || null;
    utterance.pitch = 1.05;
    utterance.rate = 0.96;
    speechSynthesis.speak(utterance);
  }
}

function updateHUD() {
  document.getElementById('turn-count').innerText = turn;
  document.getElementById('sanity-count').innerText = `${sanity}%`;
  document.getElementById('xp-count').innerText = xp;
  document.getElementById('level-count').innerText = level;
  const items = Object.keys(inventory);
  const invText = items.length ? items.join(', ') : 'none';
  document.getElementById('inventory-list').innerText = invText;
}

function getItemObject(name) {
  return allItems.find(i => i.name === name);
}

function addItem(name) {
  if (Object.keys(inventory).length >= 3) return log("❌🤬❌ 3 item limit ❌🤬❌");
  inventory[name] = true;
  updateHUD();
}

function removeItem(name) {
  delete inventory[name];
  updateHUD();
}

function useItem(name) {
  if (!inventory[name]) return log("Currently have 0 " + name + ".");
  log(`🧪 You used ${name}.`);
  const item = getItemObject(name);
  if (item && !item.permanent) removeItem(name);
  advanceTurn(true);
}

function assignGhost() {
  ghost = ghostList[Math.floor(Math.random() * ghostList.length)];
  favoriteRoom = roomList[Math.floor(Math.random() * roomList.length)];
  log(`It seems the 👻 has been summoned with a cursed object.. be careful out there..`);
}
</script>
<script>
// ==== Loadout + Inventory System Refactored ====
function getItemByName(name) {
  return allItems.find(obj => obj.name === name);
}

function addItem(itemName) {
  if (Object.keys(inventory).length >= 3) return log("❌🤬❌ 3 item limit ❌🤬❌");
  inventory[itemName] = true;
  updateHUD();
}

function removeItem(itemName) {
  delete inventory[itemName];
  updateHUD();
}

function useItem(itemName) {
  if (!inventory[itemName]) return log("Currently have 0 " + itemName + ".");
  const item = getItemByName(itemName);
  log(`🧪 You used ${itemName}.`);
  if (!item.permanent) removeItem(itemName);
  advanceTurn(true);
}

function showDropMenu() {
  const items = Object.keys(inventory);
  const container = document.getElementById('van-options');
  container.innerHTML = '';
  if (!items.length) return log("🍪 Nothing to drop.");

  items.forEach(item => {
    const btn = document.createElement('button');
    btn.innerText = `Drop ${item}`;
    btn.onclick = () => {
      removeItem(item);
      log(`🚩 Dropped ${item}.`);
      advanceTurn(true);
      document.getElementById('van-panel').classList.add('hidden');
    };
    container.appendChild(btn);
  });
  document.getElementById('van-panel').classList.remove('hidden');
}

function renderVanInterface() {
  const container = document.getElementById('van-options');
  container.innerHTML = "<h3>Manage Van Loadout</h3>";
  allItems.forEach(({ name }) => {
    const inInventory = !!inventory[name];
    const stock = vanStock[name] ?? 0;

    const btn = document.createElement('button');
    btn.innerText = `${name} ${inInventory ? '[-]' : `[+${stock}]`}`;
    btn.style.background = inInventory ? '#800' : '#060';

    btn.onclick = () => {
      if (inInventory) {
        removeItem(name);
        vanStock[name] = (vanStock[name] || 0) + 1;
      } else {
        if (Object.keys(inventory).length >= 3) return log("❌3 item limit❌");
        if (stock <= 0) return log("❌Zero in stock❌");
        inventory[name] = true;
        vanStock[name]--;
      }
      updateHUD();
      renderVanInterface();
    };

    container.appendChild(btn);
  });

  const doneBtn = document.createElement('button');
  doneBtn.innerText = "Done";
  doneBtn.style.background = '#444';
  doneBtn.onclick = () => {
    document.getElementById('van-panel').classList.add('hidden');
  };
  container.appendChild(doneBtn);
}

function renderLoadoutOptions() {
  const loadoutDiv = document.getElementById('loadout-options');
  const confirmBtn = document.getElementById('loadout-confirm');
  const loadoutScreen = document.getElementById('loadout-screen');

  allItems.forEach(({ name }) => {
    const b = document.createElement('button');
    b.innerText = name;
    b.style.minWidth = '120px';
    b.onclick = () => {
      const i = selectedLoadout.indexOf(name);
      if (i >= 0) {
        selectedLoadout.splice(i, 1);
        b.style.background = '';
      } else {
        if (selectedLoadout.length >= 3) {
          alert("Choose up to 3 items.");
          return;
        }
        selectedLoadout.push(name);
        b.style.background = 'darkgreen';
      }
    };
    loadoutDiv.appendChild(b);
  });

  confirmBtn.onclick = () => {
    if (selectedLoadout.length === 0) {
      alert("You must pick at least one item.");
      return;
    }
    selectedLoadout.forEach(name => inventory[name] = true);
    updateHUD();
    assignGhost();
    renderEvidenceChecklist();
    loadoutScreen.remove();
    speakNarration("Welcome back. I've prepared some jobs for you.");
  };
}
</script>
<script>
// === Map Room Connections ===
const roomMap = {
  'Foyer':        { North: 'Living Room', East: 'Garage', South: 'Basement' },
  'Living Room':  { South: 'Foyer', East: 'Kitchen', West: 'Dining Room' },
  'Kitchen':      { West: 'Living Room' },
  'Dining Room':  { East: 'Living Room' },
  'Bathroom':     { North: 'Bedroom' },
  'Bedroom':      { South: 'Bathroom' },
  'Garage':       { West: 'Foyer' },
  'Basement':     { North: 'Foyer' }
};

function movePlayer(direction) {
  const dest = roomMap[currentRoom]?.[direction];
  if (!dest) {
    log(`❌ You can't go ${direction} from the ${currentRoom}`);
    return;
  }
  currentRoom = dest;
  log(`🚪 You move ${direction} to the ${dest}.`);
  advanceTurn(true);
  narrateRoom();
}

function tryMove(dir) {
  movePlayer(dir);
}
</script>
<script>
// === Room-Based Ambient Narration ===
const ambientText = {
  'Foyer': ["The air feels colder than it should."],
  'Living Room': ["A TV screen reflects something behind you."],
  'Kitchen': ["Utensils rattle faintly in the drawer."],
  'Dining Room': ["One chair has been pulled out recently."],
  'Bathroom': ["The mirror fogs despite no steam."],
  'Bedroom': ["The bed looks disturbed. You didn’t touch it."],
  'Garage': ["You hear a faint metallic clang."],
  'Basement': ["It smells like mildew and secrets down here."]
};

function narrateRoom() {
  const lines = ambientText[currentRoom] || ["You feel watched from somewhere unseen."];
  if (Math.random() < 0.4) {
    const thought = lines[Math.floor(Math.random() * lines.length)];
    log("🧠 " + thought);
  }
}
</script>
<script>
// === Room-Based Ambient Narration ===
const ambientText = {
  'Foyer': ["The air feels colder than it should."],
  'Living Room': ["A TV screen reflects something behind you."],
  'Kitchen': ["Utensils rattle faintly in the drawer."],
  'Dining Room': ["One chair has been pulled out recently."],
  'Bathroom': ["The mirror fogs despite no steam."],
  'Bedroom': ["The bed looks disturbed. You didn’t touch it."],
  'Garage': ["You hear a faint metallic clang."],
  'Basement': ["It smells like mildew and secrets down here."]
};

function narrateRoom() {
  const lines = ambientText[currentRoom] || ["You feel watched from somewhere unseen."];
  if (Math.random() < 0.4) {
    const thought = lines[Math.floor(Math.random() * lines.length)];
    log("🧠 " + thought);
  }
}
</script>
<script>
function gainXP(amount) {
  xp += amount;
  while (xp >= level * 100) {
    xp -= level * 100;
    level++;
    log(`🔺 Level Up! You reached Level ${level}.`);
  }
  updateHUD();
}
</script>
<script>
function endGame(won) {
  const msg = won
    ? `🎉 You survived and earned ${xp} XP.`
    : `🪦 You died. Final XP: ${xp}`;
  document.getElementById('game-over-message').innerText = msg;
  document.getElementById('game-over-panel').style.display = 'block';
}

function restartGame() {
  inventory = {};
  selectedLoadout = [];
  sanity = 100;
  turn = 1;
  xp = 0;
  ghost = null;
  journalNotes = '';
  favoriteRoom = '';
  huntActive = false;

  document.getElementById('log').innerText = '🧠 Restarted game.';
  document.getElementById('game-over-panel').style.display = 'none';
  document.getElementById('loadout-screen').style.display = 'flex';
  document.getElementById('van-panel').classList.add('hidden');
  document.getElementById('action-panel').classList.add('hidden');
  updateHUD();
}
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const div = document.createElement('div');
  div.id = 'game-over-panel';
  div.style = `
    display:none;
    position:fixed;
    top:30%;
    left:50%;
    transform:translateX(-50%);
    background:black;
    color:white;
    padding:20px;
    border:2px solid red;
    text-align:center;
    z-index:999;
  `;
  div.innerHTML = '<h2 id="game-over-message"></h2><button onclick="restartGame()">Restart</button>';
  document.body.appendChild(div);
});
</script>
<script>
const tarotDeck = [
  "🃏 The Fool – Nothing happens.",
  "💀 Death – A hunt begins immediately!",
  "☀️ The Sun – Full sanity restored.",
  "🌑 The Moon – Sanity drops to 0.",
  "🎡 Wheel of Fortune – Random sanity shift.",
  "🗼 The Tower – Loud noise, ghost moves to your room.",
  "🧙 The Hermit – Ghost temporarily bound.",
  "👼 High Priestess – Protective spirit surrounds you."
];

function useCursedItem(name) {
  log(`🔮 You used the ${name}...`);
  if (name.toLowerCase().includes('tarot')) {
    drawTarotCard();
  }
  advanceTurn(true);
}

function drawTarotCard() {
  const card = tarotDeck[Math.floor(Math.random() * tarotDeck.length)];
  log("🃏 Tarot Card Drawn: " + card);

  if (card.includes("hunt")) triggerHunt();
  if (card.includes("Full sanity")) sanity = 100;
  if (card.includes("drops to 0")) sanity = 0;
  if (card.includes("Random sanity")) sanity = Math.floor(Math.random() * 100);
  if (card.includes("moves to your room")) {
    favoriteRoom = currentRoom;
    log("👣 You hear footsteps approaching...");
  }

  updateHUD();
}
</script>
<script>
function spawnOrbs(count = 4) {
  for (let i = 0; i < count; i++) {
    const orb = document.createElement('div');
    orb.className = 'orb';
    orb.style.left = Math.random() * 100 + 'vw';
    orb.style.top = Math.random() * 100 + 'vh';
    orb.style.setProperty('--dx', (Math.random() - 0.5) * 150 + 'px');
    orb.style.setProperty('--dy', (Math.random() - 0.5) * 150 + 'px');

    const duration = 8 + Math.random() * 10;
    orb.style.animationDuration = `${duration}s, ${duration}s`;
    orb.style.animationDelay = `0s, ${Math.random() * 3}s`;

    document.body.appendChild(orb);

    setTimeout(() => {
      orb.style.transition = 'opacity 2s ease-out';
      orb.style.opacity = 0;
      setTimeout(() => orb.remove(), 3000);
    }, duration * 1000);
  }
}

// spawn orbs every 6s while game is focused
setInterval(() => {
  if (document.hasFocus()) {
    spawnOrbs(Math.floor(Math.random() * 2) + 1);
  }
}, 6000);
</script>
<script>
const vanStock = {
  'EMF Reader': 1,
  'Spirit Box': 1,
  'Ghost Writing Book': 1,
  'Candle': 4,
  'Smudge Stick': 4,
  'Salt': 3,
  'UV Light': 1,
  'Thermometer': 1,
  'Camera': 1,
  'Parabolic Mic': 1,
  'Crucifix': 1,
  'Proximity Sensor': 1
};

function renderVanInterface() {
  const container = document.getElementById('van-options');
  container.innerHTML = "<h3>Manage Van Loadout</h3>";

  allItems.forEach(item => {
    const name = item.name;
    const inInventory = !!inventory[name];
    const stock = vanStock[name] ?? 0;

    const btn = document.createElement('button');
    btn.innerText = `${name} ${inInventory ? '[-]' : `[+${stock}]`}`;
    btn.style.background = inInventory ? '#800' : '#060';

    btn.onclick = () => {
      if (inInventory) {
        removeItem(name);
        vanStock[name] = (vanStock[name] || 0) + 1;
      } else {
        if (Object.keys(inventory).length >= 3) {
          log("❌3 item limit❌");
          return;
        }
        if (stock <= 0) {
          log("❌Zero in stock❌");
          return;
        }
        inventory[name] = true;
        vanStock[name]--;
      }
      updateHUD();
      renderVanInterface();
    };

    container.appendChild(btn);
  });

  const doneBtn = document.createElement('button');
  doneBtn.innerText = "Done";
  doneBtn.style.background = '#444';
  doneBtn.onclick = () => {
    document.getElementById('van-panel').classList.add('hidden');
  };
  container.appendChild(doneBtn);
}
</script>
<div id="item-swap-panel" style="
  display: none;
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  background: #111;
  padding: 10px;
  border: 1px solid #555;
  z-index: 30;
  width: 300px;
  border-radius: 6px;
  color: white;
">
  <div id="item-swap-header" style="margin-bottom: 10px; text-align: center;">
    What would you drop for <span id="swap-item-name" style="font-weight:bold;"></span>?
  </div>
  <div id="item-swap-options" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"></div>
  <div style="margin-top: 10px; text-align: center;">
    <button onclick="cancelItemSwap()">Nevermind</button>
    <button onclick="confirmItemSwap()">Confirm</button>
  </div>
</div>
<script>
let swapTargetItem = null;

function showDropMenu() {
  const items = Object.keys(inventory);
  const container = document.getElementById('van-options');
  container.innerHTML = '';
  if (!items.length) {
    log("🍪 Nothing to drop.");
    return;
  }
  items.forEach(item => {
    const btn = document.createElement('button');
    btn.innerText = `Drop ${item}`;
    btn.onclick = () => {
      removeItem(item);
      log(`🚩 Dropped ${item}.`);
      advanceTurn(true);
      document.getElementById('van-panel').classList.add('hidden');
    };
    container.appendChild(btn);
  });
  document.getElementById('van-panel').classList.remove('hidden');
}

function promptItemSwap(newItemName) {
  swapTargetItem = newItemName;
  const container = document.getElementById('item-swap-options');
  container.innerHTML = '';
  Object.keys(inventory).forEach(item => {
    const btn = document.createElement('button');
    btn.innerText = item;
    btn.onclick = () => confirmItemSwap(item);
    container.appendChild(btn);
  });
  document.getElementById('swap-item-name').innerText = newItemName;
  document.getElementById('item-swap-panel').style.display = 'block';
}

function cancelItemSwap() {
  document.getElementById('item-swap-panel').style.display = 'none';
  swapTargetItem = null;
}

function confirmItemSwap(itemToDrop) {
  if (!swapTargetItem) return;
  removeItem(itemToDrop);
  addItem(swapTargetItem);
  log(`🔁 Swapped ${itemToDrop} for ${swapTargetItem}.`);
  document.getElementById('item-swap-panel').style.display = 'none';
  advanceTurn(true);
  swapTargetItem = null;
}
</script>
<script>
function endGame(won) {
  const msg = won
    ? `🎉 You survived and earned ${xp} XP.`
    : `🪦 You died. Final XP: ${xp}`;
  document.getElementById('game-over-message').innerText = msg;
  document.getElementById('game-over-panel').style.display = 'block';
}

function restartGame() {
  inventory = {};
  selectedLoadout = [];
  sanity = 100;
  turn = 1;
  xp = 0;
  ghost = null;
  journalNotes = '';
  favoriteRoom = '';
  huntActive = false;
  document.getElementById('log').innerText = '🧠 Restarted game.';
  document.getElementById('game-over-panel').style.display = 'none';
  document.getElementById('loadout-screen').style.display = 'flex';
  document.getElementById('van-panel').classList.add('hidden');
  document.getElementById('action-panel').classList.add('hidden');
  updateHUD();
}

document.addEventListener('DOMContentLoaded', () => {
  const div = document.createElement('div');
  div.id = 'game-over-panel';
  div.style = `
    display: none;
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    background: black;
    color: white;
    padding: 20px;
    border: 2px solid red;
    text-align: center;
    z-index: 999;
  `;
  div.innerHTML = '<h2 id="game-over-message"></h2><button onclick="restartGame()">Restart</button>';
  document.body.appendChild(div);
});
</script>

</body>
