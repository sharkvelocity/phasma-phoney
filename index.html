<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PhasmaPhoney</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #0ff;
      font-family: monospace;
      height: 100%;
      overflow: hidden;
    }

    button {
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 8px 14px;
      margin: 4px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0ff;
      color: #000;
    }

    #orb-canvas, #background-logo, #background-image {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -2;
    }

    #background-logo {
      background: url('./logo.png') center/contain no-repeat;
      opacity: 0.1;
      z-index: -3;
    }

    #background-image {
      background: url('./house.png') center/cover no-repeat;
      z-index: -2;
    }

    #status-bar {
      padding: 10px;
      background: #000;
    }

    #game-ui {
      margin: 20px;
      padding: 10px;
      border: 1px solid #0ff;
      background: #000;
    }

    #ada-modal {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      border: 2px solid #0ff;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      height: 80%;
      z-index: 1000;
      overflow-y: auto;
    }

    #loadout-screen, #journal-screen, #item-popup, #van-panel, #guess-popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      border: 2px solid #0ff;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      z-index: 9999;
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
    }

    #journal-text {
      width: 100%;
      height: 200px;
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 10px;
    }

    #evidence-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 240px;
      background: #111;
      border: 1px solid #0ff;
      padding: 10px;
      font-family: monospace;
      z-index: 9999;
    }

    footer {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 0.8em;
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 12px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <canvas id="orb-canvas"></canvas>
  <div id="background-logo"></div>
  <div id="background-image"></div>

  <div id="loadout-screen">
    <h2>Select Your Loadout (Pick 3)</h2>
    <div id="item-selection" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
    <button onclick="confirmLoadout()">Confirm Loadout</button>
    <button onclick="randomLoadout()">Random Loadout</button>
  </div>

  <div id="journal-screen">
    <h3>Investigation Notes</h3>
    <textarea id="journal-text" placeholder="Write your notes..."></textarea>
    <br />
    <button onclick="closeJournal()">Close</button>
  </div>

  <div id="status-bar">
    Turn: <span id="turn-counter">0</span> |
    Sanity: <span id="sanity-bar">100</span>%
  </div>

  <div id="evidence-panel">
    <h3 style="margin-top:0;">Evidence</h3>
    <div id="evidence-checklist" style="display:flex; flex-direction:column; gap:6px;"></div>
    <p id="remaining-ghosts" style="margin-top:10px; font-size:0.85em; color:#0f0;"></p>
  </div>

  <div id="game-ui"></div>
  <div id="ada-modal">
    <div id="ada-log" style="height:85%;overflow-y:auto;background:#000;padding:10px;"></div>
    <div style="display:flex;flex-wrap:wrap;gap:6px;justify-content:center;">
      <button onclick="handleButtonCommand('start')">Start</button>
      <button onclick="handleButtonCommand('move')">Move</button>
      <button onclick="handleButtonCommand('map')">Map</button>
      <button onclick="handleButtonCommand('inventory')">Inventory</button>
      <button onclick="handleButtonCommand('guess')">Guess</button>
      <button onclick="handleButtonCommand('van')">Visit Van</button>
      <button onclick="handleButtonCommand('end')">End</button>
      <button onclick="openItemPopup()">Use Items</button>
    </div>
  </div>
<script>
let selectedLoadout = [];
const allLoadoutItems = [
  "EMF", "Spirit Box", "UV", "Camera", "D.O.T.S",
  "Book", "Thermometer", "Smudge", "Crucifix", "Salt", "Candle"
];

const evidenceTypes = [
  "EMF Level 5", "Spirit Box", "Fingerprints", "Ghost Writing",
  "Freezing Temps", "D.O.T.S", "Orbs"
];

const evidenceMap = {
  spirit:        ["EMF Level 5", "Spirit Box", "Ghost Writing"],
  wraith:        ["EMF Level 5", "D.O.T.S", "Spirit Box"],
  poltergeist:   ["Spirit Box", "Ghost Writing", "Fingerprints"],
  demon:         ["Ghost Writing", "Freezing Temps", "Fingerprints"],
  succubus:      ["Spirit Box", "Freezing Temps", "Orbs"]
};

const selectedEvidence = new Set();

const game = {
  started: false,
  inventory: [],
  vanStock: {
    EMF: 1, "Spirit Box": 1, UV: 1, Camera: 1, "D.O.T.S": 1,
    Book: 1, Thermometer: 1, Smudge: 4, Crucifix: 1, Salt: 3, Candle: 1
  },
  turn: 0,
  sanity: 100,
  ghost: null,
  ghostRoom: null,
  position: [0, 0],
  roomNameMap: [["Van", "Foyer", "Kitchen"], ["Basement", "Living Room", "Bathroom"], ["Garage", "Bedroom", "Storage"]]
};

// === Loadout ===
function showLoadoutScreen() {
  const container = document.getElementById("item-selection");
  container.innerHTML = "";
  selectedLoadout = [];

  allLoadoutItems.forEach(item => {
    const btn = document.createElement("button");
    btn.textContent = item;
    btn.onclick = () => {
      if (selectedLoadout.includes(item)) {
        selectedLoadout = selectedLoadout.filter(i => i !== item);
        btn.style.background = "#000";
      } else if (selectedLoadout.length < 3) {
        selectedLoadout.push(item);
        btn.style.background = "#0ff";
      } else {
        alert("Max 3 items.");
      }
    };
    container.appendChild(btn);
  });
}

function confirmLoadout() {
  game.inventory = ["Notebook", "Lighter", ...selectedLoadout];
  document.getElementById("loadout-screen").style.display = "none";
  document.getElementById("ada-modal").style.display = "block";
  simulateTyping("Deo: Tools are loaded. Proceed.");
  renderEvidenceChecklist();
}

function randomLoadout() {
  const shuffled = [...allLoadoutItems].sort(() => 0.5 - Math.random());
  selectedLoadout = shuffled.slice(0, 3);
  confirmLoadout();
}

// === Evidence ===
function renderEvidenceChecklist() {
  const container = document.getElementById("evidence-checklist");
  container.innerHTML = "";

  evidenceTypes.forEach(evidence => {
    const label = document.createElement("label");
    label.style.display = "flex";
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = selectedEvidence.has(evidence);
    checkbox.onchange = () => {
      if (checkbox.checked) selectedEvidence.add(evidence);
      else selectedEvidence.delete(evidence);
      updatePossibleGhosts();
    };
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(evidence));
    container.appendChild(label);
  });

  updatePossibleGhosts();
}

function updatePossibleGhosts() {
  const match = Object.entries(evidenceMap).filter(([ghost, evs]) =>
    Array.from(selectedEvidence).every(e => evs.includes(e))
  ).map(([ghost]) => ghost);

  const out = document.getElementById("remaining-ghosts");
  out.textContent = match.length ? `Possible: ${match.map(g => g.toUpperCase()).join(", ")}` : "No matches.";
}
</script>
<script>
// === Notebook / Journal ===
function openJournal() {
  document.getElementById("journal-screen").style.display = "block";
}
function closeJournal() {
  document.getElementById("journal-screen").style.display = "none";
}

// === Item Popup ===
function openItemPopup() {
  const popup = document.getElementById("item-popup") || createItemPopup();
  const list = document.getElementById("item-button-list");
  list.innerHTML = '';

  if (game.inventory.length === 0) {
    list.innerHTML = "<p>No items available.</p>";
  } else {
    game.inventory.forEach(item => {
      const btn = document.createElement("button");
      btn.textContent = item;
      btn.onclick = () => {
        if (item === "Notebook") {
          openJournal();
        } else {
          simulateTyping("Used: " + item);
        }
        closeItemPopup();
      };
      list.appendChild(btn);
    });
  }

  popup.style.display = 'block';
}

function closeItemPopup() {
  const popup = document.getElementById("item-popup");
  if (popup) popup.style.display = 'none';
}

function createItemPopup() {
  const div = document.createElement("div");
  div.id = "item-popup";
  div.innerHTML = `
    <h3>Choose Item to Use</h3>
    <div id="item-button-list" style="display:flex; flex-direction:column; gap:8px;"></div>
    <button onclick="closeItemPopup()">Cancel</button>
  `;
  div.style = "position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#111; padding:20px; border:2px solid #0ff; z-index:9999;";
  document.body.appendChild(div);
  return div;
}

// === Van Panel ===
function openVanPanel() {
  const panel = document.getElementById("van-panel") || createVanPanel();
  const list = document.getElementById("van-button-list");
  list.innerHTML = '';

  for (const [tool, count] of Object.entries(game.vanStock)) {
    if (count > 0) {
      const btn = document.createElement("button");
      btn.textContent = `Take ${tool}`;
      btn.onclick = () => {
        if (game.inventory.length >= 5) {
          simulateTyping("Inventory full. Drop something first.");
        } else {
          game.inventory.push(tool);
          game.vanStock[tool]--;
          simulateTyping(`Took ${tool} from van.`);
          openVanPanel();
        }
      };
      list.appendChild(btn);
    }
  }

  const divider = document.createElement("hr");
  list.appendChild(divider);
  game.inventory.forEach((item, idx) => {
    if (item === "Notebook" || item === "Lighter") return;
    const btn = document.createElement("button");
    btn.textContent = `Return ${item}`;
    btn.onclick = () => {
      game.inventory.splice(idx, 1);
      game.vanStock[item] = (game.vanStock[item] || 0) + 1;
      simulateTyping(`Returned ${item} to van.`);
      openVanPanel();
    };
    list.appendChild(btn);
  });

  panel.style.display = 'block';
}

function closeVanPanel() {
  const panel = document.getElementById("van-panel");
  if (panel) panel.style.display = "none";
}

function createVanPanel() {
  const div = document.createElement("div");
  div.id = "van-panel";
  div.innerHTML = `<h3>Van Inventory</h3><div id="van-button-list" style="display:flex; flex-direction:column; gap:6px;"></div><button onclick="closeVanPanel()">Done</button>`;
  div.style = "position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#111; padding:20px; border:2px solid #0ff; z-index:9999;";
  document.body.appendChild(div);
  return div;
}

// === Ghost Behavior Logic ===
const ghostProfiles = {
  spirit:      { intro: "Common and basic", behavior: "Faint whispering echoes..." },
  wraith:      { intro: "Avoids salt", behavior: "Air shifts... but salt untouched." },
  poltergeist: { intro: "Throws objects", behavior: "Books fly off the shelves!" },
  demon:       { intro: "Aggressive hunter", behavior: "You feel a dark presence..." },
  succubus:    { intro: "Uses seduction and fear", behavior: "A chill... and a breath on your neck." }
};

// === ADA Assistant Command Handler ===
function handleButtonCommand(cmd) {
  const c = cmd.toLowerCase();
  game.turn = (game.turn || 0) + 1;
  document.getElementById("turn-counter").textContent = game.turn;

  if (c === "start") {
    const g = Object.keys(ghostProfiles);
    game.ghost = g[Math.floor(Math.random() * g.length)];
    game.ghostRoom = "Living Room";
    simulateTyping("Deo: Ghost confirmed. Start your sweep.");
  } else if (c === "move") {
    game.sanity = Math.max(0, game.sanity - 5);
    document.getElementById("sanity-bar").textContent = game.sanity;
    simulateTyping(ghostProfiles[game.ghost]?.behavior || "You move, but nothing reacts.");
  } else if (c === "map") {
    simulateTyping("You're in the " + (game.roomNameMap?.[0]?.[0] || "Unknown"));
  } else if (c === "inventory") {
    simulateTyping("Inventory: " + game.inventory.join(", "));
  } else if (c === "van") {
    openVanPanel();
  } else if (c === "guess") {
    simulateTyping("You suspect: " + (game.ghost?.toUpperCase() || "UNKNOWN"));
  } else if (c === "end") {
    simulateTyping("You end the hunt. The ghost was: " + (game.ghost?.toUpperCase() || "UNKNOWN"));
  } else {
    simulateTyping("ADA: Command not recognized.");
  }
}

function simulateTyping(text, from = "ADA") {
  const log = document.getElementById("ada-log");
  const line = document.createElement("div");
  line.innerHTML = `<strong>${from}:</strong> `;
  line.appendChild(document.createTextNode(text));
  log.appendChild(line);
  log.scrollTop = log.scrollHeight;
}

document.addEventListener("DOMContentLoaded", showLoadoutScreen);
</script>

<footer>Phasma‑Phoney v1.3 — All Systems Integrated</footer>
</body>
</html>
