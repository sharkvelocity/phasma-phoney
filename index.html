<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phasma‚ÄëPhoney</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      overflow: hidden;
      font-family: sans-serif;
    }

    #seizure-warning {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: black;
      color: white;
      z-index: 999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 30px;
      opacity: 1;
      transition: opacity 1.5s ease;
    }

    #title-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: black;
      z-index: 100;
      opacity: 1;
      transition: opacity 2s ease-in-out;
    }

    #title-screen img {
      max-width: 80%;
      animation: pulse 5s infinite ease-in-out;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.9; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.04); }
    }

    #main-scene {
      position: relative;
      width: 100vw;
      height: 100vh;
      z-index: 1;
    }

    #background, #rain, #background-blocker, #lightning, #foreground, #fog, #spiritParticles {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    #background {
      background: url('https://raw.githubusercontent.com/sharkvelocity/phasma-phoney/refs/heads/Main/background.png') no-repeat center center;
      background-size: cover;
      z-index: 1;
    }

    #rain {
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }

    .raindrop {
      position: absolute;
      width: 2px;
      height: 12px;
      background: rgba(255, 255, 255, 0.2);
      animation: fall 0.6s linear infinite;
    }

    @keyframes fall {
      0% { transform: translateY(-100vh); opacity: 0.8; }
      100% { transform: translateY(100vh); opacity: 0; }
    }

    #background-blocker { 
      background: url('https://raw.githubusercontent.com/sharkvelocity/phasma-phoney/refs/heads/Main/rainblock.png') no-repeat center center;
      background-size: cover;
      z-index: 3;
      pointer-events: none;
    }
    #lightning { 
      background: white; opacity: 0; z-index: 4; pointer-events: none; 
    }
    #foreground {
      background: url('https://raw.githubusercontent.com/sharkvelocity/phasma-phoney/refs/heads/Main/foreground.png') no-repeat center center;
      background-size: cover;
      z-index: 5;
      pointer-events: none;
    }

    #fog {
      background: url('https://raw.githubusercontent.com/sharkvelocity/phasma-phoney/refs/heads/Main/fog.png') repeat;
      animation: fogMove 60s linear infinite;
      opacity: 0.25;
      z-index: 6;
      pointer-events: none;
    }

    #spiritParticles { z-index: 7; pointer-events: none; }

    .orb {
      position: absolute;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      opacity: 0.7;
      animation: floatOrb 8s infinite ease-in-out;
    }

    @keyframes fogMove {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    @keyframes floatOrb {
      0% { transform: translateY(0); opacity: 0.3; }
      50% { opacity: 1; }
      100% { transform: translateY(-100vh); opacity: 0; }
    }

    #evidence-panel button {
      background: #222;
      color: white;
      border: 1px solid #666;
      padding: 6px;
      cursor: pointer;
      border-radius: 4px;
    }

    #evidence-panel button.selected {
      background: #0f0;
      color: black;
      font-weight: bold;
      border-color: #0f0;
    }
  </style>
</head>
<body>
  <!-- === SEIZURE WARNING === -->
  <div id="seizure-warning">
    <h2 style="color:#f55;">‚ö† Seizure Warning</h2>
    <p style="max-width:500px; line-height:1.5em;">
      This game contains flashing lights, rapid animations, and sudden visual effects that may trigger seizures for people with photosensitive epilepsy.<br><br>
      Viewer discretion is advised.
    </p>
    <button onclick="acknowledgeSeizureWarning()" style="margin-top:30px; padding:10px 20px; font-size:1em; background:#222; color:white; border:1px solid #555; border-radius:6px; cursor:pointer;">I Understand</button>
  </div>

  <!-- === TITLE SCREEN === -->
  <div id="title-screen">
    <img src="title-logo.png" alt="Phasma‚ÄëPhoney Logo" />
  </div>

  <!-- === LAYERED SCENE === -->
  <div id="main-scene">
    <div id="background"></div>
    <div id="rain"></div>
    <div id="background-blocker"></div>
    <div id="lightning"></div>
    <div id="foreground"></div>
    <div id="fog"></div>
    <div id="spiritParticles"></div>
  </div>
  <!-- === LOADOUT SCREEN === -->
  <div id="loadout-screen" style="display:none; color:white; padding:20px; position:absolute; z-index:10; background:black; width:100%; height:100%;">
    <h2>üéí Your Inventory (max 3)</h2>
    <div id="equipped-items" class="item-grid"></div>
    <hr style="margin: 20px 0; border-color: #555;" />
    <h2>üöê Van Inventory</h2>
    <div id="van-items" class="item-grid"></div>
    <button onclick="confirmLoadout()" style="margin-top:20px;">Close Van</button>
  </div>

  <!-- === ADA PANEL === -->
  <div id="ada-modal" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#111; color:white; padding:10px; font-size:0.9em; z-index:20;">
    <div id="ada-log" style="max-height:120px; overflow-y:auto; font-family:monospace;"></div>
    <input id="ada-input" type="text" style="width:100%; background:black; color:white; border:none; padding:6px;" placeholder="Type a command (inspect, guess, use...)" onkeydown="handleAdaCommand(event)">
  </div>

  <!-- === EVIDENCE TRACKER === -->
  <div id="evidence-panel" style="position:fixed; top:10px; right:10px; background:#111; color:white; padding:10px; z-index:25; border:1px solid #444; border-radius:6px;">
    <strong>Evidence</strong>
    <div id="evidence-buttons" style="display:flex; flex-direction:column; gap:5px; margin-top:5px;"></div>
    <small style="opacity:0.7;">Click to toggle</small>
  </div>

  <!-- === RESULT SCREEN === -->
  <div id="result-popup" style="display:none; position:fixed; top:20%; left:10%; width:80%; background:#111; color:white; border:2px solid #444; z-index:50; padding:20px; text-align:center; border-radius:8px;">
    <h2 id="result-message"></h2>
    <p id="result-comment" style="margin-top:10px; font-style:italic; color:#ccc;"></p>
    <button onclick="restartGame()" id="result-button" style="margin-top:20px;">Again</button>
  </div>

  <!-- === SOUND EFFECTS === -->
  <audio id="fail-sound" src="sounds/sad-trombone.mp3"></audio>
  <audio id="win-sound" src="sounds/tada-fanfare.mp3"></audio>
<script>
  const ghostProfiles = {
    "Spirit": { evidence: ["EMF Level 5", "Spirit Box", "Ghost Writing"] },
    "Wraith": { evidence: ["EMF Level 5", "Spirit Box", "D.O.T.S"] },
    "Phantom": { evidence: ["Spirit Box", "Fingerprints", "D.O.T.S"] },
    "Poltergeist": { evidence: ["Spirit Box", "Fingerprints", "Ghost Writing"] },
    "Banshee": { evidence: ["Fingerprints", "Orbs", "D.O.T.S"] },
    "Jinn": { evidence: ["EMF Level 5", "Fingerprints", "Freezing Temps"] },
    "Mare": { evidence: ["Spirit Box", "Ghost Writing", "Orbs"] },
    "Revenant": { evidence: ["Ghost Writing", "Orbs", "Freezing Temps"] },
    "Shade": { evidence: ["EMF Level 5", "Ghost Writing", "Freezing Temps"] },
    "Demon": { evidence: ["Fingerprints", "Ghost Writing", "Freezing Temps"] },
    "Yurei": { evidence: ["Freezing Temps", "Orbs", "D.O.T.S"] },
    "Oni": { evidence: ["EMF Level 5", "Freezing Temps", "D.O.T.S"] },
    "Yokai": { evidence: ["Spirit Box", "Orbs", "D.O.T.S"] },
    "Hantu": { evidence: ["Fingerprints", "Orbs", "Freezing Temps"] },
    "Goryo": { evidence: ["EMF Level 5", "Fingerprints", "D.O.T.S"] },
    "Myling": { evidence: ["EMF Level 5", "Fingerprints", "Ghost Writing"] },
    "Onryo": { evidence: ["Spirit Box", "Orbs", "Freezing Temps"] },
    "The Twins": { evidence: ["EMF Level 5", "Spirit Box", "Freezing Temps"] },
    "Raiju": { evidence: ["EMF Level 5", "Orbs", "D.O.T.S"] },
    "Obake": { evidence: ["EMF Level 5", "Fingerprints", "Orbs"] },
    "Mimic": { evidence: ["Spirit Box", "Fingerprints", "Freezing Temps"], mimicOrbs: true },
    "Moroi": { evidence: ["Spirit Box", "Ghost Writing", "Freezing Temps"] },
    "Deogen": { evidence: ["Spirit Box", "Ghost Writing", "D.O.T.S"] },
    "Thaye": { evidence: ["Ghost Writing", "Orbs", "D.O.T.S"] },
    "The Nightmare": { evidence: ["Freezing Temps", "Ghost Writing", "Orbs"] }
  };

  const evidenceTypes = [
    "EMF Level 5", "Spirit Box", "Fingerprints",
    "Ghost Writing", "Freezing Temps", "D.O.T.S", "Orbs"
  ];

  const allLoadoutItems = [
    "EMF Reader", "Spirit Box", "Thermometer", "Camera",
    "UV Flashlight", "Ghost Writing Book", "D.O.T.S", "Crucifix",
    "Salt", "Smudge", "Motion Sensor"
  ];

  const game = {
    ghost: null,
    ghostRoom: "Garage",
    inventory: [],
    vanStock: {},
    selectedEvidence: new Set(),
    sanity: 100,
    currentTurn: 0,
    nextMimicShift: 0,
    mimicForm: null,
    playerRoom: "Garage"
  };

  const ghostBehaviors = {
    "Spirit":      { action: () => log("You hear footsteps nearby. Something's watching.") },
    "Wraith":      { action: () => log("A gust of air... it feels like the ghost teleported.") },
    "Phantom":     { action: () => { log("Your vision dims. You feel your sanity slipping."); game.sanity -= 15; }},
    "Poltergeist": { action: () => log("Several items fly off the shelf at once!") },
    "Banshee":     { action: () => log("A soft melody echoes... a singing voice?") },
    "Jinn":        { action: () => log("The temperature drops and you hear a charge building.") },
    "Mare":        { action: () => log("The lights flicker violently. Darkness surrounds you.") },
    "Revenant":    { action: () => log("You feel hunted... it's fast when you run.") },
    "Shade":       { action: () => log("Everything is eerily calm. It's avoiding attention.") },
    "Demon":       { action: () => log("An unnatural roar rattles your chest.") },
    "Yurei":       { action: () => { log("Your head feels heavy. Something is sapping your will."); game.sanity -= 10; }},
    "Oni":         { action: () => log("Objects launch across the room in a tantrum.") },
    "Yokai":       { action: () => log("A voice answers your whisper... unintelligible but real.") },
    "Hantu":       { action: () => log("The air grows icy. Your breath hangs midair.") },
    "Goryo":       { action: () => log("A shape darts through the DOTS... only on camera.") },
    "Myling":      { action: () => log("The ghost approaches silently. You barely hear it.") },
    "Onryo":       { action: () => log("A candle snuffs itself out. It fears the flame.") },
    "The Twins":   { action: () => log("Something moves upstairs... and behind you at once.") },
    "Raiju":       { action: () => log("Your equipment shorts out. Static fills the air.") },
    "Obake":       { action: () => log("You see a fingerprint... but it's distorted.") },
    "Mimic":       { action: () => mimicGhostBehavior() },
    "Moroi":       { action: () => log("A chill voice whispers a curse. Your limbs feel weak.") },
    "Deogen":      { action: () => log("You try to hide... but the ghost knows you're there.") },
    "Thaye":       { action: () => log("The activity fades. The presence weakens...") },
    "The Nightmare": { action: () => log("One of your tools fails to detect. Evidence hides from you.") }
  };
</script>
<script>
  function startTitleScreen() {
    const screen = document.getElementById("title-screen");
    screen.style.display = "flex";
    screen.onclick = () => {
      screen.style.opacity = 0;
      setTimeout(() => {
        screen.style.display = "none";
        startGameFlow();
      }, 2000);
    };
  }

  function startGameFlow() {
    const keys = Object.keys(ghostProfiles);
    game.ghost = keys[Math.floor(Math.random() * keys.length)];
    game.inventory = ["Notebook", "Lighter"];
    game.vanStock = {};
    allLoadoutItems.forEach(i => {
      game.vanStock[i] = (i === "Smudge" ? 4 : i === "Salt" ? 3 : 1);
    });
    showLoadoutMenu();
  }

  function confirmLoadout() {
    if (!game.inventory.includes("Notebook")) game.inventory.push("Notebook");
    if (!game.inventory.includes("Lighter")) game.inventory.push("Lighter");
    document.getElementById("loadout-screen").style.display = "none";
    document.getElementById("ada-modal").style.display = "block";
    setupEvidencePanel();
    log(`Investigation begins. Ghost is haunting the ${game.ghostRoom}.`);
  }

  function handleAdaCommand(e) {
    if (e.key === "Enter") {
      const cmd = e.target.value.trim().toLowerCase();
      e.target.value = "";
      if (!cmd) return;

      if (cmd.startsWith("guess ")) {
        guessGhost(cmd.slice(6));
      } else if (cmd === "inventory") {
        log("You are holding: " + game.inventory.join(", "));
      } else if (cmd === "use camera") {
        if (game.ghost === "Mimic" && game.playerRoom === game.ghostRoom) {
          showMimicOrbs();
          log("You focus the camera... Orbs flicker in the air.");
        } else {
          log("You scan the room... but nothing shows.");
        }
      } else {
        log("Unknown command.");
      }

      advanceTurn();
    }
  }

  function advanceTurn() {
    game.currentTurn++;

    if (game.ghost === "Mimic") {
      if (game.nextMimicShift === 0 || game.currentTurn >= game.nextMimicShift) {
        pickMimicForm();
        game.nextMimicShift = game.currentTurn + (3 + Math.floor(Math.random() * 4));
      }
      mimicGhostBehavior();
    } else {
      const behavior = ghostBehaviors[game.ghost];
      if (behavior && behavior.action) behavior.action();
    }

    log(`Current sanity: ${game.sanity}%`);
  }

  function pickMimicForm() {
    const ghosts = Object.keys(ghostBehaviors).filter(g => g !== "Mimic");
    const newForm = ghosts[Math.floor(Math.random() * ghosts.length)];
    game.mimicForm = newForm;
    log(`Mimic now imitates a ${newForm}.`);
  }

  function mimicGhostBehavior() {
    if (game.mimicForm && ghostBehaviors[game.mimicForm]) {
      const behavior = ghostBehaviors[game.mimicForm];
      if (behavior.action) behavior.action();
    }
  }

  function guessGhost(name) {
    const correct = name.toLowerCase() === game.ghost.toLowerCase();
    const dead = false;
    endInvestigation(correct, dead);
  }

  function endInvestigation(correct, dead) {
    const popup = document.getElementById("result-popup");
    const msg = document.getElementById("result-message");
    const comment = document.getElementById("result-comment");
    const btn = document.getElementById("result-button");

    if (dead) {
      msg.textContent = "You died.";
      comment.textContent = getInsult();
      btn.className = "lose";
      document.getElementById("fail-sound").play();
    } else if (correct) {
      msg.textContent = "You correctly identified the ghost!";
      comment.textContent = getPraise();
      btn.className = "win";
      document.getElementById("win-sound").play();
    } else {
      msg.textContent = "You were wrong.";
      comment.textContent = getInsult();
      btn.className = "lose";
      document.getElementById("fail-sound").play();
    }

    popup.style.display = "block";
  }

  function restartGame() {
    document.getElementById("result-popup").style.display = "none";
    startGameFlow();
  }

  function getPraise() {
    return [
      "Flawless deduction.",
      "That ghost didn't stand a chance.",
      "You're a natural.",
      "Even ADA is impressed.",
      "Legendary hunting."
    ][Math.floor(Math.random() * 5)];
  }

  function getInsult() {
    return [
      "The ghost played you.",
      "Wrong again. Yikes.",
      "You may want to quit.",
      "Maybe let ADA guess next time.",
      "Utter embarrassment."
    ][Math.floor(Math.random() * 5)];
  }

  function setupEvidencePanel() {
    const container = document.getElementById("evidence-buttons");
    container.innerHTML = "";
    evidenceTypes.forEach(type => {
      const btn = document.createElement("button");
      btn.textContent = type;
      btn.onclick = () => {
        if (game.selectedEvidence.has(type)) {
          game.selectedEvidence.delete(type);
          btn.classList.remove("selected");
        } else {
          game.selectedEvidence.add(type);
          btn.classList.add("selected");
        }
        updateEvidenceMatch();
      };
      container.appendChild(btn);
    });
  }

  function updateEvidenceMatch() {
    const matches = Object.entries(ghostProfiles).filter(([name, data]) => {
      for (let e of game.selectedEvidence) {
        if (!data.evidence.includes(e)) return false;
      }
      return true;
    });
    log("Possible ghosts: " + matches.map(([n]) => n).join(", "));
  }

  function showLoadoutMenu() {
    game.inventory = game.inventory.filter(i => i === "Notebook" || i === "Lighter");
    renderEquipped();
    renderVan();
    document.getElementById("loadout-screen").style.display = "block";
  }

  function renderEquipped() {
    const eqDiv = document.getElementById("equipped-items");
    eqDiv.innerHTML = "";
    game.inventory.forEach((item, index) => {
      if (item === "Notebook" || item === "Lighter") return;
      const btn = document.createElement("button");
      btn.textContent = item;
      btn.onclick = () => unequipItem(index);
      eqDiv.appendChild(btn);
    });
    renderVan();
  }

  function renderVan() {
    const vanDiv = document.getElementById("van-items");
    vanDiv.innerHTML = "";
    Object.entries(game.vanStock).forEach(([item, count]) => {
      const btn = document.createElement("button");
      btn.textContent = `${item} (${count})`;
      const disabled = count <= 0 || getEquippedCount() >= 3;
      btn.disabled = disabled;
      btn.onclick = () => {
        if (getEquippedCount() < 3) equipItem(item);
      };
      vanDiv.appendChild(btn);
    });
  }

  function getEquippedCount() {
    return game.inventory.filter(i => i !== "Notebook" && i !== "Lighter").length;
  }

  function equipItem(item) {
    if (getEquippedCount() >= 3) return;
    if (game.vanStock[item] > 0) {
      game.inventory.push(item);
      game.vanStock[item]--;
      renderEquipped();
    }
  }

  function unequipItem(index) {
    const item = game.inventory[index];
    if (item !== "Notebook" && item !== "Lighter") {
      game.vanStock[item] = (game.vanStock[item] || 0) + 1;
      game.inventory.splice(index, 1);
      renderEquipped();
    }
  }

  function showMimicOrbs() {
    const container = document.getElementById("spiritParticles");
    container.innerHTML = "";
    for (let i = 0; i < 15; i++) {
      const orb = document.createElement("div");
      orb.className = "orb";
      orb.style.left = `${Math.random() * 100}vw`;
      orb.style.top = `${Math.random() * 100}vh`;
      orb.style.animationDuration = `${5 + Math.random() * 4}s`;
      orb.style.opacity = `${0.3 + Math.random() * 0.6}`;
      container.appendChild(orb);
    }
    setTimeout(() => container.innerHTML = "", 5000);
  }

  function log(msg) {
    const logDiv = document.getElementById("ada-log");
    logDiv.innerHTML += `<div>> ${msg}</div>`;
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  window.addEventListener("DOMContentLoaded", () => {
    if (sessionStorage.getItem("seizureAcknowledged")) {
      document.getElementById("seizure-warning").style.display = "none";
      startTitleScreen();
    }
  });

  function acknowledgeSeizureWarning() {
    sessionStorage.setItem("seizureAcknowledged", "yes");
    document.getElementById("seizure-warning").style.opacity = 0;
    setTimeout(() => {
      document.getElementById("seizure-warning").style.display = "none";
      startTitleScreen();
    }, 1500);
  }

  window.onload = () => {
    spawnSpiritParticles();
    spawnRain();
  };

  function spawnSpiritParticles(count = 40) {
    const container = document.getElementById("spiritParticles");
    container.innerHTML = "";
    for (let i = 0; i < count; i++) {
      const orb = document.createElement("div");
      orb.className = "orb";
      orb.style.left = `${Math.random() * 100}vw`;
      orb.style.top = `${Math.random() * 100}vh`;
      orb.style.animationDuration = `${6 + Math.random() * 6}s`;
      orb.style.opacity = `${0.2 + Math.random() * 0.5}`;
      container.appendChild(orb);
    }
  }

  function spawnRain(count = 100) {
    const rain = document.getElementById("rain");
    rain.innerHTML = "";
    for (let i = 0; i < count; i++) {
      const drop = document.createElement("div");
      drop.className = "raindrop";
      drop.style.left = Math.random() * 100 + "vw";
      drop.style.animationDelay = Math.random() + "s";
      rain.appendChild(drop);
    }
  }
</script>
</body>
</html>

